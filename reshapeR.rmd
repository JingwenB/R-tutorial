
---
title: "Reshape"
output:
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```
### Intro
In this tutorial we will focusing on the reshape of a data frame in R.
First we need to know what are wide-format data or long-format data. Wide data has a column for each variable. While long data using all variable as values.

### Build a simple data frame

We created a simple wide data `df`, where it has a column for each variable. 

```{r}
df <- data.frame(x = c('A','B','C'),'2020' = c(1,3,4),'2021' = c(3,5,2),check.names = FALSE)
head(df)
``` 
### Use melt function in package reshape2 

Melt takes wide-format data and melts it into long-format data.



```{r}
library(reshape2)
df_melt <- reshape2::melt(df,id.vars = "x",variable.name = "year",value.name = "value")
head(df_melt)
```


df_gather <- tidyr::gather(df,year,value,-x)
head(df_gather)
  
df_cast <- reshape2::dcast(df_melt, x~year,value.var = 'value')
head(df_cast)
 
df_spread <- tidyr::spread(df_gather,year,value)
head(df_spread)
# 变量的变换
dat1 <- transform(df_melt,value2 = value*2)
head(dat1)
 
dat2 <- transform(df_melt,value2 = ifelse(year=="2018",value*2,value+1))
head(dat2)
 
dat2 <- dplyr::mutate(df_melt,value2 = ifelse(year=="2018",value*2,value+1))
head(dat2)
 
# 表格的排序
dat_arrange1 <- dplyr::arrange(df_melt,value)
head(dat_arrange1)
 
dat_arrange2 <- dplyr::arrange(df_melt,desc(value))
head(dat_arrange2)
